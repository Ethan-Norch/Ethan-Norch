C51 COMPILER V9.59.0.0   MAIN                                                              10/12/2019 10:51:27 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\keil5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main.l
                    -st) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "reg52.h"
   2          #include "lcd12864.h"
   3          //#include "at24c02.h"
   4          #include "as608.h"
   5          #include "timer2.h"
   6          //#include "key.h"
   7          #define uchar unsigned char
   8          #define uint unsigned int
   9          
  10          sbit beep=P3^7;
  11          sbit led=P0^0;
  12          sbit key=P1^0;
  13          
  14          #define max 100
  15          uchar mode=0;       //0normal unlock,1add,2init,3delete
  16          uint id=0;          //save enter id
  17          bit fpF=0;          //mark the fingerprint collection
  18          bit zhiwenF=0;
  19          bit delF=0;
  20          bit longP=0;
  21          bit pressFlag;
  22          
  23          void delayms(uint ms)
  24          {
  25   1        uchar i;
  26   1        while(ms--)
  27   1        {
  28   2          for(i=0;i<80;i++);
  29   2        }
  30   1          
  31   1      }
  32          
  33          void keypro()
  34          {
  35   1        if(key==0)
  36   1        {
  37   2          delayms(10);
  38   2          if(!key)
  39   2          {
  40   3            pressFlag=1;
  41   3            while(!key)
  42   3            {
  43   4              delayms(2500);
  44   4              if(!key)
  45   4                longP=1;
  46   4            }
  47   3          }
  48   2        }
  49   1      }
  50              
  51          void beeping(uchar i)    //loop for i times,the beep beeps i times
  52          {
  53   1        uchar j;
  54   1        for(j=0;j<i;j++)
C51 COMPILER V9.59.0.0   MAIN                                                              10/12/2019 10:51:27 PAGE 2   

  55   1        {
  56   2          beep=0;
  57   2          led=0;
  58   2          delayms(40);
  59   2          beep=1;
  60   2          led=1;
  61   2          delayms(40);
  62   2        }
  63   1      }
  64          
  65          
  66          void cucun()
  67          {
  68   1        lcdWriteCom(0x01);
  69   1        lcdDisplayString(0,1,"ADD FINGERPRINT");
  70   1        delayms(500);
  71   1        if(enroll()==1)
  72   1        {
  73   2          id++;
  74   2          if(savefingure(id)==1)
  75   2          {
  76   3            lcdDisplayString(3,2,"SAVED");
  77   3            delayms(2000);
  78   3            lcdWriteCom(0x01);
  79   3          }
  80   2          else
  81   2          {
  82   3            lcdDisplayString(0,2,"SAVING FAIL");
  83   3            delayms(1000);
  84   3            lcdWriteCom(0x01);
  85   3            id--;
  86   3          }
  87   2        }
  88   1        else
  89   1        {
  90   2          lcdDisplayString(0,2,"COLLECTING FAIL");
  91   2          delayms(1000);
  92   2          lcdWriteCom(0x01);
  93   2        }
  94   1        zhiwenF=0;
  95   1        mode=0;
  96   1      }
  97          void shanchu()
  98          {
  99   1        lcdWriteCom(0x01);
 100   1        if(Clear_All()==1)
 101   1        {
 102   2          lcdDisplayString(1,1,"ALL DELETED");
 103   2          delayms(2000);
 104   2          lcdWriteCom(0x01); 
 105   2          mode=2;
 106   2          id=0;
 107   2        }
 108   1        else
 109   1        {
 110   2          lcdDisplayString(1,1,"DELETE FAIL");
 111   2          delayms(1000);
 112   2          lcdWriteCom(0x01);
 113   2          mode=0;
 114   2        }
 115   1      }
 116          
C51 COMPILER V9.59.0.0   MAIN                                                              10/12/2019 10:51:27 PAGE 3   

 117          void fpSearch()
 118          {
 119   1        searchNum=search();     //search fp
 120   1        if((searchNum>=1&&searchNum<=max)||searchNum==255)     //maximum
 121   1        {
 122   2          if(searchNum>=1&&searchNum<=max)    //success
 123   2          {
 124   3            jdq=0;
 125   3            T2_num=0;           //recounting
 126   3            TR2=1;
 127   3            lcdWriteCom(0x01);
 128   3            lcdDisplayString(0,1,"    WELCOME");
 129   3            delayms(2000);
 130   3            lcdWriteCom(0x01);
 131   3          }
 132   2          else     //wrong
 133   2          {
 134   3            beeping(3);
 135   3          }
 136   2          delayms(500);
 137   2        }
 138   1        mode=0;
 139   1      }
 140          
 141          
 142          void main()
 143          {
 144   1        
 145   1      //  uchar k;
 146   1      //  lcdInit();
 147   1      //  lcdDisplayString(0,2,"test");
 148   1      //  while(1)
 149   1      //  {
 150   1      //    k=keypro();
 151   1      //    if(k==1)
 152   1      //    {
 153   1      //      lcdDisplayString(0,1,"add finger");
 154   1      //    }
 155   1      //    else
 156   1      //      if(k==2)
 157   1      //        lcdDisplayString(0,1,"delete");
 158   1      //    }
 159   1      //  uchar k=0;
 160   1        lcdInit();
 161   1        UartInit();
 162   1        T2_init();
 163   1        mode=2;
 164   1        while(1)
 165   1        {
 166   2          if(mode==1&&zhiwenF==1)
 167   2            cucun();
 168   2          if(mode==3&&delF==1)
 169   2            shanchu();
 170   2          if(mode==2)
 171   2          {
 172   3            lcdDisplayString(1,1,"INITIATING...");
 173   3            lcdDisplayString(0,2,"SET FINGERPRINT");
 174   3            delayms(500);
 175   3            if(enroll()==1)
 176   3            {
 177   4              lcdDisplayString(0,3,"COMMUNICATING>>>");
 178   4              id++;
C51 COMPILER V9.59.0.0   MAIN                                                              10/12/2019 10:51:27 PAGE 4   

 179   4              if(savefingure(id)==1)
 180   4              {
 181   5                lcdWriteCom(0x01);
 182   5                lcdDisplayString(0,1,"SETTING SUCCESS");
 183   5                delayms(2000);
 184   5                lcdWriteCom(0x01);
 185   5                mode=0;
 186   5              }
 187   4              else
 188   4              {
 189   5                id=0;
 190   5                lcdWriteCom(0x01);
 191   5                lcdDisplayString(1,1,"SETTING FAILURE");
 192   5              }
 193   4            }
 194   3            else
 195   3            { 
 196   4              lcdWriteCom(0x01);
 197   4              lcdDisplayString(1,1,"COLLECTING FAIL");
 198   4            }
 199   3          }
 200   2          else
 201   2            if(mode!=2)
 202   2            {
 203   3              keypro();
 204   3              if(pressFlag==1&&(!longP))
 205   3              {
 206   4                pressFlag=0;
 207   4                mode=1;
 208   4                lcdWriteCom(0x01);
 209   4                lcdDisplayString(1,1,"ADD FINGER");
 210   4                lcdDisplayString(0,2,"COMMUNICATING>>>");
 211   4                while(1)
 212   4                {
 213   5                  searchNum=search();
 214   5                  if((searchNum>=1&&searchNum<=max)||searchNum==255)
 215   5                  {
 216   6                    if(searchNum>=1&&searchNum<=max)
 217   6                    {
 218   7                      zhiwenF=1;
 219   7                      break;
 220   7                    }
 221   6                    else
 222   6                    {
 223   7                      lcdWriteCom(0x01);
 224   7                      beeping(3);
 225   7                      lcdDisplayString(1,1,"NULL FINGER");
 226   7                      delayms(1000);
 227   7                      lcdWriteCom(0x01);
 228   7                      mode=0;
 229   7                      break;
 230   7                    }
 231   6                  }
 232   5                }
 233   4              }
 234   3              else
 235   3                if(pressFlag==1&&longP==1)
 236   3                {
 237   4                  pressFlag=0;
 238   4                  longP=0;
 239   4                  lcdWriteCom(0x01);
 240   4                  lcdDisplayString(1,1,"DELETE ALL");
C51 COMPILER V9.59.0.0   MAIN                                                              10/12/2019 10:51:27 PAGE 5   

 241   4                  lcdDisplayString(0,2,"COMMUNICATING>>>");
 242   4                  while(1)
 243   4                  {
 244   5                    mode=3;
 245   5                    searchNum=search();
 246   5                    if((searchNum>=1&&searchNum<=max)||searchNum==255)
 247   5                    {
 248   6                      if(searchNum>=1&&searchNum<=max)
 249   6                      {
 250   7                        if(searchNum==1)
 251   7                        {
 252   8                          delF=1;
 253   8                          break;
 254   8                        }
 255   7                        
 256   7                      }
 257   6                      else
 258   6                      {
 259   7                        lcdWriteCom(0x01);
 260   7                        beeping(3);
 261   7                        lcdDisplayString(1,1,"UNAUTHORIZED");
 262   7                        delayms(1000);
 263   7                        lcdWriteCom(0x01);
 264   7                        mode=0;
 265   7                        break;
 266   7                      }
 267   6                    }
 268   5                  }
 269   4                }
 270   3                else
 271   3                  if(mode==0)
 272   3                  {
 273   4                    lcdDisplayString(0,1,"     LOCKED");
 274   4                    lcdDisplayString(0,2,"COMMUNICATING>>>");
 275   4                    fpSearch();
 276   4                  }
 277   3                }
 278   2              }
 279   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2168    ----
   CONSTANT SIZE    =    374    ----
   XDATA SIZE       =     64    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9      19
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      5       4
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
